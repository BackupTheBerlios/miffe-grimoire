if    [  -f  $CONFIG_LOGS/$SPELL/host.def  ];  then
  cat        $CONFIG_LOGS/$SPELL/host.def    >  \
                            config/cf/host.def
    (

    echo  "#define DefaultCCOptions       $CFLAGS"
    echo  "#define DefaultGcc2i386Opt     $CFLAGS"
    echo  "#define LibraryCDebugFlags     $CFLAGS"
    echo  "#define DefaultCDebugFlags     $CFLAGS"
    echo  "#define OptimizedCDebugFlags   $CFLAGS"
    echo  "#define LOCAL_LDFLAGS          ${LDFLAGS:--Wl,-s}"
    echo  "#define HasZlib                YES"
    echo  "#define InstallXdmConfig       YES"
    echo  "#define InstallXinitConfig     YES"

    echo  "#define BuildFreeType          NO"

    echo  "#define HasFreetype2           YES"
    echo  "#define BuildFreetype2Library  NO"
    echo  "#define UseFreetype2           YES"
    echo  "#define Freetype2LibDir        /usr/lib"

#    echo  "#define HasFontconfig          YES"
#    echo  "#define UseFontconfig          YES"
#    echo  "#define BuildFontconfigLibrary NO"
#    echo  "#define FontconfigLibDir       /usr/lib"

#    echo  "#define BuildXftLibrary        NO"
#    echo  "#define BuildXft1Library       NO"

    echo  "#define BuildFonts             NO"

    )  >> config/cf/host.def

fi

( 

  echo	"Patching r200 Mesa driver"
  cd	$BUILD_DIR/lib/GL/mesa/src/drv/r200
  cat	$BUILD_DIR/ati.2/r200-4.3.0.patch | patch -p0
      
  echo	"Patching radeon Mesa driver"
  cd	$BUILD_DIR/lib/GL/mesa/src/drv/radeon
  cat	$BUILD_DIR/ati.2/radeon-4.3.0.patch | patch -p0
  cd	$BUILD_DIR
	      
  echo   "Adding fontconfig-2.2.0 with fixed patch"
  patch  -p0  <  $SCRIPT_DIR/fontconfig-2.2.0.patch
  cp     -av     fontconfig-2.2.0/*  lib/fontconfig/
#  rm     -rf     fontconfig-2.2.0

  if    spell_installed  "$( get_provider  Linux-PAM  )"
    then  echo  "#define  HasPam  YES"  >>  config/cf/site.def
  fi

  sed  -i  "s:/usr/bin/cpp:cpp:"  config/cf/linux.cf

  make  World								&&
  cd	$BUILD_DIR/ati.2						&&
  $BUILD_DIR/config/util/xmkmf $BUILD_DIR				&&
  make									&&
  cd	$BUILD_DIR/drm-kernel						&&
  make	-f Makefile.linux						&&
  cd	$BUILD_DIR/fontconfig-2.2.0					&&
  configure --sysconfdir=/etc --prefix=/usr --mandir=/usr/share/man	&&
  make									&&
  cd	$BUILD_DIR							&&
  prepare_install							&&  
  make  install								&&
  make  install.man							&&
  cd	$BUILD_DIR/ati.2						&&
  make	install								&&
  cd	$BUILD_DIR/drm-kernel						&&
  cat	$SCRIPT_DIR/Makefile.patch | patch -p0				&&
  make	-f Makefile.linux install					&&
  cd    $BUILD_DIR/fontconfig-2.2.0					&&
  make  install								&&
  cd	$BUILD_DIR							&&
  mkdir  -p  /usr/X11R6/include/GL


) > $C_FIFO 2>&1  &&  (

  ULP="/usr/lib/pkgconfig"
  [      -d  $ULP  ]  ||
  mkdir  -p  $ULP
  cp     -a  /usr/X11R6/lib/pkgconfig/*  $ULP

  rm     -f  /usr/X11R6/include/zlib.h
  rm     -f  /usr/X11R6/lib/libz.a

  if  [  !  -e                /etc/skel/.xsession  ];  then
    cp  $SCRIPT_DIR/xsession  /etc/skel/.xsession
  fi

  if  [  !  -e                    /usr/bin/X11  ];  then
    ln      -sf   /usr/X11R6/bin  /usr/bin/X11
  fi

  if  [  !  -e          /usr/X11  ];  then
    ln      -sf  X11R6  /usr/X11
  fi

  if  [  !  -e                         /usr/include/X11  ];  then
    ln      -sf  ../X11R6/include/X11  /usr/include/X11
  fi

  if  [  !  -e                     /usr/lib/X11  ];  then
    ln      -sf  ../X11R6/lib/X11  /usr/lib/X11
  fi

)
